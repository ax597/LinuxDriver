## 第一讲

### linux驱动开发思维

- Linux下驱动开发直接使用寄存器不现实
- 根据linux下的各种驱动框架进行开发。满足**框架**很重要，也就是Linux下各种驱动框架的掌握。
- 驱动的最终表现为/dev/xxx。既然驱动也是文件，那么就可以进行打开、关闭、读写等操作。
- 现在的内核支持设备树，即.dts文件，此文件描述了板子的设备信息。

### linux驱动开发分类

1. 字符设备驱动（GPIO|SPI|IIC...）
2. 块设备驱动(emmc|SD card|nano flash ... )
3. 网络设备驱动

一个设备不一定知识与某一个类型，如USB WIFI|SDIO WIFI，既属于网络设备驱动，同时因为他又有USB和SDIO，因此也属于字符设备驱动。

## 第二讲

### 应用程序和驱动的交互原理

1. 驱动就是获取外设、或者传感器数据，控制外设。数据会提交给应用程序。Linux驱动编写既要编写一个驱动，还要我们编写一个简单的测试程序。单片机下驱动和应用都是放到一个文件，杂糅。Linux下驱动和应用是完全分开的。linux内核和驱动程序运行在内核态，应用程序运行在用户态。应用程序想要访问内核资源就要通过三种方式：①系统调用②异常③陷入。（什么是软中断，什么是硬中断？）

### 字符设备驱动开发流程

1. Linux一切皆文件。驱动设备表现为一个/dev/下的文件，例如/dev/led。应用程序调用open函数打开设备，比如led。应用程序通过write函数向/dev/led写数据。比如写1表示打开，0表示关闭。如果关闭设备就是close函数。
2. 编写驱动时需要编写驱动对应的open|close|write函数。字符设备驱动的结构体。
3. 考虑应用开发的便利性
4. 驱动是分驱动框架的，要按照驱动框架来写。对于字符设备来讲，重新编写应用程序对应的open|read|write|close等函数。

### 字符设备驱动简介

#### 字符设备驱动框架

按照字节流进行操作设备。

应用：open|close|read|write..

字符设备的编写主要就是编写对应的驱动中的：open|close|read|write。在Linux内核文件include/linux/fs.h中有file_operations。其实就是file_operations结构体成员变量的实现。

#### 驱动模块的加载与卸载

Linux驱动程序可以编译到kernel中，也就是zimage,也可以加载为模块.ko。测试的时候只需要加载.ko模块就可以了。

